2023-12-14T12:28:09.326+05:00  INFO 27364 --- [main] com.example.SecurityApplication          : Starting SecurityApplication using Java 19.0.2 with PID 27364 (C:\Users\ASUS\IdeaProjects\Security\target\classes started by ASUS in C:\Users\ASUS\IdeaProjects\Security)
2023-12-14T12:28:09.404+05:00 DEBUG 27364 --- [main] com.example.SecurityApplication          : Running with Spring Boot v3.0.1, Spring v6.0.3
2023-12-14T12:28:09.408+05:00  INFO 27364 --- [main] com.example.SecurityApplication          : No active profile set, falling back to 1 default profile: "default"
2023-12-14T12:28:13.211+05:00  INFO 27364 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2023-12-14T12:28:13.475+05:00  INFO 27364 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 230 ms. Found 2 JPA repository interfaces.
2023-12-14T12:28:15.651+05:00  INFO 27364 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8082 (http)
2023-12-14T12:28:15.684+05:00  INFO 27364 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2023-12-14T12:28:15.686+05:00  INFO 27364 --- [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.4]
2023-12-14T12:28:15.958+05:00  INFO 27364 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2023-12-14T12:28:15.959+05:00  INFO 27364 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 6389 ms
2023-12-14T12:28:16.448+05:00  INFO 27364 --- [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2023-12-14T12:28:16.638+05:00  INFO 27364 --- [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.1.6.Final
2023-12-14T12:28:17.315+05:00  WARN 27364 --- [main] org.hibernate.orm.deprecation            : HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
2023-12-14T12:28:17.743+05:00  INFO 27364 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2023-12-14T12:28:18.403+05:00  INFO 27364 --- [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5ab7ac02
2023-12-14T12:28:18.408+05:00  INFO 27364 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2023-12-14T12:28:18.583+05:00  INFO 27364 --- [main] SQL dialect                              : HHH000400: Using dialect: org.hibernate.dialect.PostgreSQLDialect
2023-12-14T12:28:21.607+05:00  INFO 27364 --- [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2023-12-14T12:28:21.640+05:00  INFO 27364 --- [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2023-12-14T12:28:23.418+05:00 DEBUG 27364 --- [main] com.example.config.JwtTokenFilter        : Filter 'jwtTokenFilter' configured for use
2023-12-14T12:28:29.653+05:00  INFO 27364 --- [main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@6b6cf3c1, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@702e21c, org.springframework.security.web.context.SecurityContextHolderFilter@27563444, org.springframework.security.web.header.HeaderWriterFilter@4fd70118, org.springframework.security.web.authentication.logout.LogoutFilter@73543048, com.example.config.JwtTokenFilter@1abd1a28, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@73796ae5, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@3956e933, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5c450960, org.springframework.security.web.access.ExceptionTranslationFilter@671561b9, org.springframework.security.web.access.intercept.AuthorizationFilter@77737e3e]
2023-12-14T12:28:31.754+05:00  INFO 27364 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8082 (http) with context path ''
2023-12-14T12:28:31.806+05:00  INFO 27364 --- [main] com.example.SecurityApplication          : Started SecurityApplication in 24.072 seconds (process running for 36.902)
2023-12-14T12:28:32.132+05:00  INFO 27364 --- [main] o.f.c.internal.license.VersionPrinter    : Flyway Community Edition 9.5.1 by Redgate
2023-12-14T12:28:32.132+05:00  INFO 27364 --- [main] o.f.c.internal.license.VersionPrinter    : See what's new here: https://flywaydb.org/documentation/learnmore/releaseNotes#9.5.1
2023-12-14T12:28:32.134+05:00  INFO 27364 --- [main] o.f.c.internal.license.VersionPrinter    : 
2023-12-14T12:28:32.253+05:00  INFO 27364 --- [main] o.f.c.i.database.base.BaseDatabaseType   : Database: jdbc:postgresql://localhost:5432/kun_uz (PostgreSQL 15.2)
2023-12-14T12:28:32.551+05:00  INFO 27364 --- [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2023-12-14T12:28:32.660+05:00 ERROR 27364 --- [main] o.s.boot.SpringApplication               : Application run failed

java.lang.IllegalStateException: Failed to execute CommandLineRunner
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:770) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:751) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:315) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1302) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1291) ~[spring-boot-3.0.1.jar:3.0.1]
	at com.example.SecurityApplication.main(SecurityApplication.java:9) ~[classes/:na]
Caused by: org.flywaydb.core.api.exception.FlywayValidateException: Validate failed: Migrations have failed validation
Migration checksum mismatch for migration version 2
-> Applied to database : -1883849977
-> Resolved locally    : 47579415
Either revert the changes to the migration, or run repair to update the schema history.
Need more flexibility with validation rules? Learn more: https://rd.gt/3AbJUZE
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:134) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:204) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.Flyway.migrate(Flyway.java:128) ~[flyway-core-9.5.1.jar:na]
	at com.example.config.runner.CommandLineAppStartupRunner.run(CommandLineAppStartupRunner.java:16) ~[classes/:na]
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:767) ~[spring-boot-3.0.1.jar:3.0.1]
	... 5 common frames omitted

2023-12-14T12:28:32.780+05:00  INFO 27364 --- [main] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2023-12-14T12:28:32.798+05:00  INFO 27364 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2023-12-14T12:28:32.813+05:00  INFO 27364 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2023-12-14T12:30:03.985+05:00  INFO 28932 --- [main] com.example.SecurityApplication          : Starting SecurityApplication using Java 19.0.2 with PID 28932 (C:\Users\ASUS\IdeaProjects\Security\target\classes started by ASUS in C:\Users\ASUS\IdeaProjects\Security)
2023-12-14T12:30:04.025+05:00 DEBUG 28932 --- [main] com.example.SecurityApplication          : Running with Spring Boot v3.0.1, Spring v6.0.3
2023-12-14T12:30:04.028+05:00  INFO 28932 --- [main] com.example.SecurityApplication          : No active profile set, falling back to 1 default profile: "default"
2023-12-14T12:30:06.579+05:00  INFO 28932 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2023-12-14T12:30:06.803+05:00  INFO 28932 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 201 ms. Found 2 JPA repository interfaces.
2023-12-14T12:30:08.637+05:00  INFO 28932 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8082 (http)
2023-12-14T12:30:08.663+05:00  INFO 28932 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2023-12-14T12:30:08.665+05:00  INFO 28932 --- [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.4]
2023-12-14T12:30:08.948+05:00  INFO 28932 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2023-12-14T12:30:08.949+05:00  INFO 28932 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 4767 ms
2023-12-14T12:30:09.323+05:00  INFO 28932 --- [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2023-12-14T12:30:09.473+05:00  INFO 28932 --- [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.1.6.Final
2023-12-14T12:30:10.060+05:00  WARN 28932 --- [main] org.hibernate.orm.deprecation            : HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
2023-12-14T12:30:10.438+05:00  INFO 28932 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2023-12-14T12:30:11.013+05:00  INFO 28932 --- [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@45d7495e
2023-12-14T12:30:11.019+05:00  INFO 28932 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2023-12-14T12:30:11.170+05:00  INFO 28932 --- [main] SQL dialect                              : HHH000400: Using dialect: org.hibernate.dialect.PostgreSQLDialect
2023-12-14T12:30:14.012+05:00  INFO 28932 --- [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2023-12-14T12:30:14.042+05:00  INFO 28932 --- [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2023-12-14T12:30:15.793+05:00 DEBUG 28932 --- [main] com.example.config.JwtTokenFilter        : Filter 'jwtTokenFilter' configured for use
2023-12-14T12:30:21.281+05:00  INFO 28932 --- [main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@e98004e, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@368e7d3a, org.springframework.security.web.context.SecurityContextHolderFilter@c680819, org.springframework.security.web.header.HeaderWriterFilter@3f0c2eff, org.springframework.security.web.authentication.logout.LogoutFilter@671561b9, com.example.config.JwtTokenFilter@8cce9ad, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@40aaf656, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5a183fa6, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@381f05a9, org.springframework.security.web.access.ExceptionTranslationFilter@3bbb3c84, org.springframework.security.web.access.intercept.AuthorizationFilter@73796ae5]
2023-12-14T12:30:23.139+05:00  INFO 28932 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8082 (http) with context path ''
2023-12-14T12:30:23.203+05:00  INFO 28932 --- [main] com.example.SecurityApplication          : Started SecurityApplication in 20.628 seconds (process running for 22.999)
2023-12-14T12:30:23.514+05:00  INFO 28932 --- [main] o.f.c.internal.license.VersionPrinter    : Flyway Community Edition 9.5.1 by Redgate
2023-12-14T12:30:23.515+05:00  INFO 28932 --- [main] o.f.c.internal.license.VersionPrinter    : See what's new here: https://flywaydb.org/documentation/learnmore/releaseNotes#9.5.1
2023-12-14T12:30:23.515+05:00  INFO 28932 --- [main] o.f.c.internal.license.VersionPrinter    : 
2023-12-14T12:30:23.604+05:00  INFO 28932 --- [main] o.f.c.i.database.base.BaseDatabaseType   : Database: jdbc:postgresql://localhost:5432/kun_uz (PostgreSQL 15.2)
2023-12-14T12:30:23.855+05:00  INFO 28932 --- [main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.116s)
2023-12-14T12:30:23.923+05:00  INFO 28932 --- [main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "public"."flyway_schema_history" with baseline ...
2023-12-14T12:30:24.098+05:00  INFO 28932 --- [main] o.f.core.internal.command.DbBaseline     : Successfully baselined schema with version: 1
2023-12-14T12:30:24.558+05:00  INFO 28932 --- [main] o.f.core.internal.command.DbMigrate      : Current version of schema "public": 1
2023-12-14T12:30:24.584+05:00  INFO 28932 --- [main] o.f.core.internal.command.DbMigrate      : Migrating schema "public" to version "2 - initAdmin"
2023-12-14T12:30:24.649+05:00 ERROR 28932 --- [main] o.f.core.internal.command.DbMigrate      : Migration of schema "public" to version "2 - initAdmin" failed! Changes successfully rolled back.
2023-12-14T12:30:24.674+05:00  INFO 28932 --- [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2023-12-14T12:30:24.797+05:00 ERROR 28932 --- [main] o.s.boot.SpringApplication               : Application run failed

java.lang.IllegalStateException: Failed to execute CommandLineRunner
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:770) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:751) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:315) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1302) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1291) ~[spring-boot-3.0.1.jar:3.0.1]
	at com.example.SecurityApplication.main(SecurityApplication.java:9) ~[classes/:na]
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__initAdmin.sql failed
----------------------------------
SQL State  : 23503
Error Code : 0
Message    : ERROR: insert or update on table "profile" violates foreign key constraint "fkol7hbk7arjubdo9ce832xe569"
  Detail: Key (photo_id)=(643d5efc-a7ad-4374-a8b0-af5c13a707f1) is not present in table "attach".
Location   : db/migration/V2__initAdmin.sql (C:\Users\ASUS\IdeaProjects\Security\target\classes\db\migration\V2__initAdmin.sql)
Line       : 1
Statement  : INSERT INTO profile(id, created_date, email, name, surname, password, phone, photo_id, role, status)
VALUES (
           3,
           '2023-12-07 23:55:11.160562',
           'raufovmaruf777@gmail.com',
           'Raufov',
           'Maruf',
           'f9919e52ce90b0e41d0f9ced7fb8b3bd', -- Added comma here
           '+998932222077',
           '643d5efc-a7ad-4374-a8b0-af5c13a707f1',
           'ROLE_ADMIN',
           'ACTIVE'
       )

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:384) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:274) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:273) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:246) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:141) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:73) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.postgresql.PostgreSQLAdvisoryLockTemplate.lambda$execute$0(PostgreSQLAdvisoryLockTemplate.java:56) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:56) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.postgresql.PostgreSQLConnection.lock(PostgreSQLConnection.java:96) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:143) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:141) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:98) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:176) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:204) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.Flyway.migrate(Flyway.java:128) ~[flyway-core-9.5.1.jar:na]
	at com.example.config.runner.CommandLineAppStartupRunner.run(CommandLineAppStartupRunner.java:16) ~[classes/:na]
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:767) ~[spring-boot-3.0.1.jar:3.0.1]
	... 5 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__initAdmin.sql failed
----------------------------------
SQL State  : 23503
Error Code : 0
Message    : ERROR: insert or update on table "profile" violates foreign key constraint "fkol7hbk7arjubdo9ce832xe569"
  Detail: Key (photo_id)=(643d5efc-a7ad-4374-a8b0-af5c13a707f1) is not present in table "attach".
Location   : db/migration/V2__initAdmin.sql (C:\Users\ASUS\IdeaProjects\Security\target\classes\db\migration\V2__initAdmin.sql)
Line       : 1
Statement  : INSERT INTO profile(id, created_date, email, name, surname, password, phone, photo_id, role, status)
VALUES (
           3,
           '2023-12-07 23:55:11.160562',
           'raufovmaruf777@gmail.com',
           'Raufov',
           'Maruf',
           'f9919e52ce90b0e41d0f9ced7fb8b3bd', -- Added comma here
           '+998932222077',
           '643d5efc-a7ad-4374-a8b0-af5c13a707f1',
           'ROLE_ADMIN',
           'ACTIVE'
       )

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:275) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:376) ~[flyway-core-9.5.1.jar:na]
	... 23 common frames omitted
Caused by: org.postgresql.util.PSQLException: ERROR: insert or update on table "profile" violates foreign key constraint "fkol7hbk7arjubdo9ce832xe569"
  Detail: Key (photo_id)=(643d5efc-a7ad-4374-a8b0-af5c13a707f1) is not present in table "attach".
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2676) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2366) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:356) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:496) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:413) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:333) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:319) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:295) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:290) ~[postgresql-42.5.1.jar:42.5.1]
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94) ~[HikariCP-5.0.1.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java) ~[HikariCP-5.0.1.jar:na]
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210) ~[flyway-core-9.5.1.jar:na]
	... 29 common frames omitted

2023-12-14T12:30:24.943+05:00  INFO 28932 --- [main] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2023-12-14T12:30:24.960+05:00  INFO 28932 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2023-12-14T12:30:24.974+05:00  INFO 28932 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2023-12-14T12:41:50.497+05:00  INFO 4712 --- [main] com.example.SecurityApplication          : Starting SecurityApplication using Java 19.0.2 with PID 4712 (C:\Users\ASUS\IdeaProjects\Security\target\classes started by ASUS in C:\Users\ASUS\IdeaProjects\Security)
2023-12-14T12:41:50.539+05:00 DEBUG 4712 --- [main] com.example.SecurityApplication          : Running with Spring Boot v3.0.1, Spring v6.0.3
2023-12-14T12:41:50.541+05:00  INFO 4712 --- [main] com.example.SecurityApplication          : No active profile set, falling back to 1 default profile: "default"
2023-12-14T12:41:53.238+05:00  INFO 4712 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2023-12-14T12:41:53.458+05:00  INFO 4712 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 191 ms. Found 2 JPA repository interfaces.
2023-12-14T12:41:55.366+05:00  INFO 4712 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8082 (http)
2023-12-14T12:41:55.394+05:00  INFO 4712 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2023-12-14T12:41:55.396+05:00  INFO 4712 --- [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.4]
2023-12-14T12:41:55.695+05:00  INFO 4712 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2023-12-14T12:41:55.696+05:00  INFO 4712 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 5022 ms
2023-12-14T12:41:56.165+05:00  INFO 4712 --- [main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2023-12-14T12:41:56.309+05:00  INFO 4712 --- [main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.1.6.Final
2023-12-14T12:41:56.860+05:00  WARN 4712 --- [main] org.hibernate.orm.deprecation            : HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
2023-12-14T12:41:57.222+05:00  INFO 4712 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2023-12-14T12:41:57.784+05:00  INFO 4712 --- [main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5ab7ac02
2023-12-14T12:41:57.790+05:00  INFO 4712 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2023-12-14T12:41:57.961+05:00  INFO 4712 --- [main] SQL dialect                              : HHH000400: Using dialect: org.hibernate.dialect.PostgreSQLDialect
2023-12-14T12:42:00.949+05:00  INFO 4712 --- [main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2023-12-14T12:42:00.978+05:00  INFO 4712 --- [main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2023-12-14T12:42:02.642+05:00 DEBUG 4712 --- [main] com.example.config.JwtTokenFilter        : Filter 'jwtTokenFilter' configured for use
2023-12-14T12:42:08.786+05:00  INFO 4712 --- [main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@154cbb46, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@58fbecde, org.springframework.security.web.context.SecurityContextHolderFilter@73543048, org.springframework.security.web.header.HeaderWriterFilter@7de2c19c, org.springframework.security.web.authentication.logout.LogoutFilter@27b7913, com.example.config.JwtTokenFilter@5f346355, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@33f3ebfc, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5cb3cfef, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@299615a5, org.springframework.security.web.access.ExceptionTranslationFilter@6c8f5262, org.springframework.security.web.access.intercept.AuthorizationFilter@7f065f9e]
2023-12-14T12:42:10.688+05:00  INFO 4712 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8082 (http) with context path ''
2023-12-14T12:42:10.743+05:00  INFO 4712 --- [main] com.example.SecurityApplication          : Started SecurityApplication in 21.763 seconds (process running for 23.914)
2023-12-14T12:42:11.029+05:00  INFO 4712 --- [main] o.f.c.internal.license.VersionPrinter    : Flyway Community Edition 9.5.1 by Redgate
2023-12-14T12:42:11.030+05:00  INFO 4712 --- [main] o.f.c.internal.license.VersionPrinter    : See what's new here: https://flywaydb.org/documentation/learnmore/releaseNotes#9.5.1
2023-12-14T12:42:11.030+05:00  INFO 4712 --- [main] o.f.c.internal.license.VersionPrinter    : 
2023-12-14T12:42:11.116+05:00  INFO 4712 --- [main] o.f.c.i.database.base.BaseDatabaseType   : Database: jdbc:postgresql://localhost:5432/kun_uz (PostgreSQL 15.2)
2023-12-14T12:42:11.348+05:00  INFO 4712 --- [main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.145s)
2023-12-14T12:42:11.421+05:00  INFO 4712 --- [main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "public"."flyway_schema_history" with baseline ...
2023-12-14T12:42:11.576+05:00  INFO 4712 --- [main] o.f.core.internal.command.DbBaseline     : Successfully baselined schema with version: 1
2023-12-14T12:42:11.643+05:00  INFO 4712 --- [main] o.f.core.internal.command.DbMigrate      : Current version of schema "public": 1
2023-12-14T12:42:11.667+05:00  INFO 4712 --- [main] o.f.core.internal.command.DbMigrate      : Migrating schema "public" to version "2 - initAdmin"
2023-12-14T12:42:11.725+05:00 ERROR 4712 --- [main] o.f.core.internal.command.DbMigrate      : Migration of schema "public" to version "2 - initAdmin" failed! Changes successfully rolled back.
2023-12-14T12:42:11.750+05:00  INFO 4712 --- [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2023-12-14T12:42:11.911+05:00 ERROR 4712 --- [main] o.s.boot.SpringApplication               : Application run failed

java.lang.IllegalStateException: Failed to execute CommandLineRunner
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:770) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:751) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:315) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1302) ~[spring-boot-3.0.1.jar:3.0.1]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1291) ~[spring-boot-3.0.1.jar:3.0.1]
	at com.example.SecurityApplication.main(SecurityApplication.java:9) ~[classes/:na]
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__initAdmin.sql failed
----------------------------------
SQL State  : 23503
Error Code : 0
Message    : ERROR: insert or update on table "profile" violates foreign key constraint "fkol7hbk7arjubdo9ce832xe569"
  Detail: Key (photo_id)=(643d5efc-a7ad-4374-a8b0-af5c13a707f1) is not present in table "attach".
Location   : db/migration/V2__initAdmin.sql (C:\Users\ASUS\IdeaProjects\Security\target\classes\db\migration\V2__initAdmin.sql)
Line       : 1
Statement  : INSERT INTO profile(id, created_date, email, name, surname, password, phone, photo_id, role, status)
VALUES (
           3,
           '2023-12-07 23:55:11.160562',
           'raufovmaruf777@gmail.com',
           'Raufov',
           'Maruf',
           'f9919e52ce90b0e41d0f9ced7fb8b3bd', -- Added comma here
           '+998932222077',
           '643d5efc-a7ad-4374-a8b0-af5c13a707f1',
           'ROLE_ADMIN',
           'ACTIVE'
        )

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:384) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:274) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:273) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:246) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:141) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:73) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.postgresql.PostgreSQLAdvisoryLockTemplate.lambda$execute$0(PostgreSQLAdvisoryLockTemplate.java:56) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.postgresql.PostgreSQLAdvisoryLockTemplate.execute(PostgreSQLAdvisoryLockTemplate.java:56) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.postgresql.PostgreSQLConnection.lock(PostgreSQLConnection.java:96) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:143) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:141) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:98) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:176) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:204) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.Flyway.migrate(Flyway.java:128) ~[flyway-core-9.5.1.jar:na]
	at com.example.config.runner.CommandLineAppStartupRunner.run(CommandLineAppStartupRunner.java:16) ~[classes/:na]
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:767) ~[spring-boot-3.0.1.jar:3.0.1]
	... 5 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__initAdmin.sql failed
----------------------------------
SQL State  : 23503
Error Code : 0
Message    : ERROR: insert or update on table "profile" violates foreign key constraint "fkol7hbk7arjubdo9ce832xe569"
  Detail: Key (photo_id)=(643d5efc-a7ad-4374-a8b0-af5c13a707f1) is not present in table "attach".
Location   : db/migration/V2__initAdmin.sql (C:\Users\ASUS\IdeaProjects\Security\target\classes\db\migration\V2__initAdmin.sql)
Line       : 1
Statement  : INSERT INTO profile(id, created_date, email, name, surname, password, phone, photo_id, role, status)
VALUES (
           3,
           '2023-12-07 23:55:11.160562',
           'raufovmaruf777@gmail.com',
           'Raufov',
           'Maruf',
           'f9919e52ce90b0e41d0f9ced7fb8b3bd', -- Added comma here
           '+998932222077',
           '643d5efc-a7ad-4374-a8b0-af5c13a707f1',
           'ROLE_ADMIN',
           'ACTIVE'
        )

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:275) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:376) ~[flyway-core-9.5.1.jar:na]
	... 23 common frames omitted
Caused by: org.postgresql.util.PSQLException: ERROR: insert or update on table "profile" violates foreign key constraint "fkol7hbk7arjubdo9ce832xe569"
  Detail: Key (photo_id)=(643d5efc-a7ad-4374-a8b0-af5c13a707f1) is not present in table "attach".
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2676) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2366) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:356) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:496) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:413) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:333) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.executeCachedSql(PgStatement.java:319) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.executeWithFlags(PgStatement.java:295) ~[postgresql-42.5.1.jar:42.5.1]
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:290) ~[postgresql-42.5.1.jar:42.5.1]
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94) ~[HikariCP-5.0.1.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java) ~[HikariCP-5.0.1.jar:na]
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95) ~[flyway-core-9.5.1.jar:na]
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210) ~[flyway-core-9.5.1.jar:na]
	... 29 common frames omitted

2023-12-14T12:42:12.059+05:00  INFO 4712 --- [main] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2023-12-14T12:42:12.101+05:00  INFO 4712 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2023-12-14T12:42:12.115+05:00  INFO 4712 --- [main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
